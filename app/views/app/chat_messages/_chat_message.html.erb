<div id="<%= dom_id chat_message %>" data-controller="scroll-into-view">
  <div class="flex <%= chat_message.author == 'user' ? 'justify-start' : 'justify-end' %>">
    <div class="max-w-xs md:max-w-md px-4 py-3 rounded-2xl shadow bg-indigo-900/60 border border-indigo-800/30 text-white <%= chat_message.author == 'user' ? 'rounded-bl-none' : 'rounded-br-none bg-indigo-800/80' %>">
      <div class="whitespace-pre-line break-words">
        <%= chat_message.body %>
      </div>
      <div class="flex items-center justify-between mt-2">
        <button 
          onclick="copyToClipboard('<%= dom_id chat_message %>')"
          class="text-indigo-300 hover:text-indigo-100 transition-colors duration-200 p-1 rounded hover:bg-indigo-700/50"
          title="Copy message"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
        </button>
        <div class="text-xs text-indigo-200">
          <%= chat_message.created_at.strftime('%H:%M') if chat_message.respond_to?(:created_at) && chat_message.created_at %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyToClipboard(messageId) {
  const messageElement = document.getElementById(messageId);
  const messageText = messageElement.querySelector('.whitespace-pre-line').textContent.trim();
  
  navigator.clipboard.writeText(messageText).then(function() {
    // Show success feedback
    const button = messageElement.querySelector('button');
    const originalHTML = button.innerHTML;
    
    // Temporarily show checkmark
    button.innerHTML = `
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
    `;
    button.classList.add('text-green-400');
    
    // Reset after 2 seconds
    setTimeout(() => {
      button.innerHTML = originalHTML;
      button.classList.remove('text-green-400');
    }, 2000);
  }).catch(function(err) {
    console.error('Could not copy text: ', err);
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = messageText;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
  });
}
</script>
